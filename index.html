<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Pixelate Photo</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:Arial,Helvetica,sans-serif; display:flex; flex-direction:column; gap:12px; align-items:center; padding:24px;}
  canvas{border:1px solid #ccc;}
</style>
</head>
<body>
  <h2>Pixelizar imagem</h2>
  <input id="file" type="file" accept="image/*">
  <label>Pixel size: <input id="size" type="range" min="2" max="50" value="8"></label>
  <canvas id="out"></canvas>
  <a id="download" style="display:none">Download</a>

<script>
const fileIn = document.getElementById('file');
const out = document.getElementById('out');
const sizeControl = document.getElementById('size');
const download = document.getElementById('download');

fileIn.addEventListener('change', () => {
  const f = fileIn.files[0];
  if (!f) return;
  const url = URL.createObjectURL(f);
  loadAndPixelate(url, parseInt(sizeControl.value,10));
});

sizeControl.addEventListener('input', () => {
  const imgUrl = out.dataset.src;
  if (imgUrl) loadAndPixelate(imgUrl, parseInt(sizeControl.value,10));
});

function loadAndPixelate(src, pixelSize){
  const img = new Image();
  img.onload = () => {
    // canvas tempor√°rio menor
    const w = img.width, h = img.height;
    const smallW = Math.max(1, Math.floor(w / pixelSize));
    const smallH = Math.max(1, Math.floor(h / pixelSize));

    const temp = document.createElement('canvas');
    temp.width = smallW; temp.height = smallH;
    const tctx = temp.getContext('2d', {willReadFrequently:true});
    tctx.drawImage(img, 0, 0, smallW, smallH);

    out.width = smallW * pixelSize;
    out.height = smallH * pixelSize;
    const ctx = out.getContext('2d');
    ctx.imageSmoothingEnabled = false;
    // desenha ampliado (efeito pixelado)
    ctx.clearRect(0,0,out.width,out.height);
    ctx.drawImage(temp, 0, 0, out.width, out.height);

    out.dataset.src = src;
    download.style.display = 'inline-block';
    download.href = out.toDataURL('image/png');
    download.download = 'pixel_art.png';
    download.textContent = 'Baixar PNG pixelizado';
  };
  img.src = src;
}
</script>
</body>
</html>

